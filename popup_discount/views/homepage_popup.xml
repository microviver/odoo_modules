<odoo>
  <template id="homepage_popup_script_injection" name="Popup Email Capture Injection" inherit_id="website.layout">
    <xpath expr="//body" position="inside">
      <script type="module">
        document.addEventListener("DOMContentLoaded", function () {
          console.log("âœ… Popup script loaded via website.layout"); // Adicionado para depuraÃ§Ã£o
          if (!localStorage.getItem("popup_shown")) {
            var popup = document.createElement("div");
            popup.innerHTML = `
              <div style="position:fixed;top:20%;left:50%;transform:translateX(-50%);
                          background:#fff;padding:20px;border-radius:8px;box-shadow:0 0 10px #000;z-index:9999;">
                <h3>ðŸŽ‰ Â¡ObtÃ©n un 5% de desconto!</h3>
                <p>Introduce tu correo electrÃ³nico para recibir tu cÃ³digo exclusivo.</p>
                <input type="email" id="popup_email" placeholder="Tu correo" />
                <button onclick="enviarCorreo()">Enviar</button>
              </div>
            `;
            document.body.appendChild(popup);
            localStorage.setItem("popup_shown", "true");
            console.log("Popup shown for the first time."); // Adicionado para depuraÃ§Ã£o
          } else {
            console.log("Popup not shown (popup_shown already exists in localStorage)."); // Adicionado para depuraÃ§Ã£o
          }
        });

        // Esta funÃ§Ã£o precisa de estar no escopo global para ser acessÃ­vel via onclick
        window.enviarCorreo = function() {
          var email = document.getElementById("popup_email").value;
          if (email) {
            fetch("/newsletter/popup", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ email: email }),
            }).then(() => {
              alert("Â¡Correo enviado! Revisa tu bandeja.");
              // Opcional: fechar o popup apÃ³s o envio
              var popupContainer = document.querySelector("#popup_email").closest("div[style*='position:fixed']");
              if (popupContainer) {
                  popupContainer.remove();
              }
            }).catch(error => {
                console.error("Erro ao enviar e-mail:", error);
                alert("Ocorreu um erro ao enviar o seu e-mail.");
            });
          } else {
              alert("Por favor, insira o seu e-mail.");
          }
        };
      </script>
    </xpath>
  </template>
</odoo>
